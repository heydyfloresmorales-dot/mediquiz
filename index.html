<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MediQuiz - Test</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
.container { max-width:800px; margin:0 auto; }
header { text-align:center; margin-bottom:20px; }
h1 { color:#05183D; }
.card { background:#fff; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
button { padding:10px 20px; margin:5px; cursor:pointer; border:none; border-radius:5px; background:#245175; color:#fff; }
button:disabled { background:#ccc; cursor:not-allowed; }
#activityLog { background:#eee; padding:10px; max-height:150px; overflow-y:auto; font-family:monospace; font-size:14px; }
.question { margin-top:20px; }
.option { margin:5px 0; }
</style>
</head>
<body>
<div class="container">
<header>
<h1>📚 MediQuiz - Test</h1>
<p>Prueba de conexión y carga de preguntas</p>
</header>

<div class="card">
<h2>Configuración</h2>
<label for="sheetsUrl">ID o URL de Google Sheets:</label>
<input type="text" id="sheetsUrl" placeholder="ID del Sheet">

<label for="gasUrl">URL del Google Apps Script:</label>
<input type="text" id="gasUrl" placeholder="URL del Web App">

<button onclick="testConnection()">Probar Conexión</button>
<button onclick="loadQuestions()" id="loadBtn" disabled>Cargar Preguntas</button>
</div>

<div class="card" id="questionCard" style="display:none;">
<h2>Pregunta</h2>
<div id="questionText"></div>
<div id="options"></div>
</div>

<div class="card">
<h2>Log</h2>
<div id="activityLog"></div>
</div>
</div>

<script>
let systemData = { sheetsId:'', gasUrl:'', questions:[] };

function log(msg) {
    const logEl = document.getElementById('activityLog');
    const ts = new Date().toLocaleTimeString();
    logEl.innerHTML += `[${ts}] ${msg}<br>`;
    logEl.scrollTop = logEl.scrollHeight;
}

function extractSheetsId(url) {
    if (/^[a-zA-Z0-9-_]+$/.test(url)) return url;
    const m = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
    return m ? m[1] : url;
}

async function testConnection() {
    const sheetsUrl = document.getElementById('sheetsUrl').value.trim();
    const gasUrl = document.getElementById('gasUrl').value.trim();
    if(!sheetsUrl || !gasUrl){ alert('Ingresa ambos'); return; }
    systemData.sheetsId = extractSheetsId(sheetsUrl);
    systemData.gasUrl = gasUrl;

    log('Probando conexión...');
    try {
        const res = await fetch(gasUrl, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({ action:'test', sheetsId: systemData.sheetsId })
        });
        const data = await res.json();
        if(data.success){
            log('✅ Conexión OK: ' + data.message);
            document.getElementById('loadBtn').disabled = false;
        } else {
            throw new Error(data.error || 'Error desconocido');
        }
    } catch(e){
        log('❌ Error: ' + e.message);
    }
}

async function loadQuestions() {
    log('Cargando preguntas...');
    try {
        const res = await fetch(systemData.gasUrl, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({ action:'getQuestions', sheetsId: systemData.sheetsId })
        });
        const data = await res.json();
        if(data.success){
            systemData.questions = data.questions;
            log(`✅ ${data.questions.length} preguntas cargadas`);
            showQuestion(0);
        } else {
            throw new Error(data.error || 'Error cargando preguntas');
        }
    } catch(e){
        log('❌ Error: ' + e.message);
    }
}

function showQuestion(index){
    if(!systemData.questions.length) return;
    const q = systemData.questions[index];
    document.getElementById('questionCard').style.display = 'block';
    document.getElementById('questionText').textContent = q.texto;
    const opts = ['opcionA','opcionB','opcionC','opcionD'];
    const optsHtml = opts.map(o => `<div class="option">${q[o]}</div>`).join('');
    document.getElementById('options').innerHTML = optsHtml;
}
</script>
</body>
</html>


